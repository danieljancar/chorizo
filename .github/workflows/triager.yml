name: Issue and PR Triage Labeler

on:
  issues:
    types: [opened]
  pull_request:
    types: [opened]

jobs:
  label-triage:
    runs-on: ubuntu-latest
    steps:
      - name: Add triage label to new issues and PRs from non-collaborators
        uses: actions/github-script@v5
        with:
          script: |
            const payload = context.issue || context.pull_request;
            const contributorType = payload.user.type;
            const repoOwner = context.repo.owner;
            const repoName = context.repo.repo;

            async function checkCollaborator(username) {
              try {
                await github.rest.repos.checkCollaborator({
                  owner: repoOwner,
                  repo: repoName,
                  username: username,
                });
                return true;
              } catch (error) {
                return false;
              }
            }

            const isCollaborator = await checkCollaborator(payload.user.login);

            if (!isCollaborator) {
              await github.rest.issues.addLabels({
                owner: repoOwner,
                repo: repoName,
                issue_number: payload.number,
                labels: ['triage']
              });
            }
          repo-token: ${{ secrets.GITHUB_TOKEN }}
